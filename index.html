<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—…æ­¥ç”œå¿ƒ v2.0</title>
    <style>
        :root {
            --bg-color: #FFF0F5;
            --card-bg: #FFFFFF;
            --primary-pink: #FFB7C5;
            --deep-pink: #FF69B4;
            --text-color: #5D4037;
            --input-bg: #FFFBFD;
        }

        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .app-container {
            width: 100%;
            max-width: 400px;
            background-color: var(--card-bg);
            box-shadow: 0 4px 20px rgba(255, 182, 193, 0.3);
            min-height: 100vh;
            padding-bottom: 120px; /* é ç•™åº•éƒ¨ç©ºé–“çµ¦æŒ‰éˆ• */
            position: relative;
        }

        /* é ‚éƒ¨å°èˆªåˆ— (å«è²¨å¹£åˆ‡æ›) */
        .header {
            background-color: var(--primary-pink);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
        }
        .header-title { font-weight: bold; font-size: 1.1rem; }
        
        /* å¯æ„›ä¸‹æ‹‰é¸å–®æ¨£å¼ */
        select {
            padding: 8px 12px;
            border: 2px solid var(--primary-pink);
            border-radius: 12px;
            background-color: white;
            color: var(--text-color);
            font-size: 0.9rem;
            outline: none;
            cursor: pointer;
            appearance: none; /* ç§»é™¤é è¨­ç®­é ­ */
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23FF69B4' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 16px;
            padding-right: 30px;
        }

        .content { padding: 20px; }

        /* æ—¥æœŸå€å¡Š */
        .section-row { margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .label { font-size: 0.9rem; font-weight: bold; color: var(--deep-pink); min-width: 70px;}

        /* é‡‘é¡å¤§å¡ç‰‡ */
        .amount-card {
            background: var(--bg-color);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            border: 2px solid white;
            box-shadow: 0 4px 10px rgba(255,182,193,0.1);
        }
        .currency-symbol { font-size: 1.5rem; color: var(--deep-pink); margin-right: 5px; }
        .currency-input {
            width: 60%;
            border: none;
            background: transparent;
            border-bottom: 2px solid var(--deep-pink);
            font-size: 2rem;
            text-align: center;
            color: var(--deep-pink);
            outline: none;
        }

        /* è¡¨å–®æ§åˆ¶é … */
        .form-group { margin-bottom: 15px; }
        .full-width-select { width: 100%; padding: 12px; font-size: 1rem; }
        
        /* è³¼ç‰©æ¸…å–®å€å¡Š */
        .shopping-box {
            border: 2px dashed var(--primary-pink);
            border-radius: 15px;
            padding: 10px;
            background: #FFFBFD;
            margin-bottom: 20px;
        }
        .add-row { display: flex; gap: 5px; margin-top: 10px; }
        .btn-mini {
            background: var(--deep-pink); color: white; border: none;
            border-radius: 8px; padding: 0 12px; cursor: pointer;
        }

        /* åº•éƒ¨çµ±è¨ˆé¢æ¿ */
        .stats-panel {
            margin-top: 30px;
            background: #fff;
            border-top: 2px solid #eee;
            padding: 20px;
        }
        .stats-title { font-size: 1rem; font-weight: bold; color: var(--text-color); margin-bottom: 10px; }
        .stats-row { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px; color: #666; }
        .stats-total { font-weight: bold; color: var(--deep-pink); font-size: 1.1rem; border-top: 1px dashed #ccc; padding-top: 5px; margin-top: 5px; }

        /* å„²å­˜æŒ‰éˆ• */
        .save-btn {
            width: 90%;
            position: fixed; /* å›ºå®šåœ¨åº•éƒ¨ */
            bottom: 20px;
            left: 5%;
            max-width: 360px; /* é…åˆ container */
            background-color: var(--deep-pink);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.4);
            cursor: pointer;
            z-index: 100;
        }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="header">
            <div class="header-title">âœˆï¸ æ—…æ­¥ç”œå¿ƒ</div>
            <select id="countrySelect" onchange="changeCountry()" style="border:none; color: var(--deep-pink); font-weight:bold;">
                <option value="KR">ğŸ‡°ğŸ‡· éŸ“åœ‹ (KRW)</option>
                <option value="TH">ğŸ‡¹ğŸ‡­ æ³°åœ‹ (THB)</option>
                <option value="JP">ğŸ‡¯ğŸ‡µ æ—¥æœ¬ (JPY)</option>
            </select>
        </div>

        <div class="content">
            <div class="section-row">
                <span class="label">ğŸ“… æ—¥æœŸ</span>
                <input type="date" id="dateInput" style="padding:8px; border:1px solid #ccc; border-radius:10px; font-family:inherit;">
            </div>

            <div class="amount-card">
                <div>
                    <span id="curSymbol" class="currency-symbol">â‚©</span>
                    <input type="number" id="amountInput" class="currency-input" placeholder="0" oninput="manualAmountChange()">
                </div>
                <div style="font-size: 0.9rem; margin-top: 5px; color: #888;">
                    â‰ˆ NT$ <span id="twdDisplay">0</span>
                </div>
            </div>

            <div class="form-group">
                <div class="label" style="margin-bottom:5px;">ğŸ“‚ èŠ±è²»åˆ†é¡</div>
                <div style="display: flex; gap: 10px;">
                    <select id="mainCat" class="full-width-select" onchange="updateSubCats()">
                        <option value="shopping">ğŸ›ï¸ è³¼ç‰©</option>
                        <option value="food">ğŸœ ç¾é£Ÿ</option>
                        <option value="transport">ğŸšŒ äº¤é€š</option>
                        <option value="stay">ğŸ  ä½å®¿</option>
                    </select>
                    <select id="subCat" class="full-width-select">
                        </select>
                </div>
            </div>

            <div class="shopping-box">
                <div style="font-size:0.9rem; font-weight:bold; color:var(--deep-pink); margin-bottom:5px;">ğŸ“¸ æ‹ç…§è¨˜å¸³ / æ˜ç´°</div>
                <ul id="itemList" style="padding-left:20px; margin:5px 0; font-size:0.9rem; color:#666;">
                    </ul>
                <div class="add-row">
                    <input type="text" id="itemName" placeholder="å“å/åº—å" style="width:40%; padding:5px; border-radius:5px; border:1px solid #eee;">
                    <input type="number" id="itemPrice" placeholder="é‡‘é¡" style="width:30%; padding:5px; border-radius:5px; border:1px solid #eee;">
                    <button class="btn-mini" onclick="addItem()">ï¼‹åŠ å…¥</button>
                </div>
            </div>

            <div class="form-group">
                <div class="label" style="margin-bottom:5px;">ğŸ’³ ä»˜æ¬¾æ–¹å¼</div>
                <select id="paymentMethod" class="full-width-select">
                    </select>
            </div>

            <div class="stats-panel">
                <div class="stats-title">ğŸ“Š 1/18 ä»Šæ—¥æˆ°ç¸¾ (é è¦½)</div>
                <div id="statsContent">
                    <div class="stats-row"><span>ğŸ›ï¸ è³¼ç‰©ç¸½è¨ˆ</span><span>NT$ 0</span></div>
                    <div class="stats-row"><span>ğŸœ ç¾é£Ÿç¸½è¨ˆ</span><span>NT$ 0</span></div>
                    <div class="stats-row"><span>ğŸšŒ äº¤é€šç¸½è¨ˆ</span><span>NT$ 0</span></div>
                    <div class="stats-total stats-row"><span>ğŸ”¥ ç¸½èŠ±è²»</span><span>NT$ 0</span></div>
                </div>
            </div>
        </div>
        
        <button class="save-btn" onclick="saveRecord()">âœ¨ å­˜å…¥é€™ç­†èŠ±è²»</button>
    </div>

    <script>
        // --- 1. è³‡æ–™è¨­å®š (å«åœ‹å®¶å¹£åˆ¥æ“´å……) ---
        const countryConfig = {
            'KR': { 
                symbol: 'â‚©', 
                rate: 0.024, 
                payments: ['ç¾é‡‘', 'åˆ·å¡', 'T-money', 'WOWPASS', 'Apple Pay'] 
            },
            'TH': { 
                symbol: 'à¸¿', 
                rate: 0.90, 
                payments: ['ç¾é‡‘', 'åˆ·å¡', 'Rabbit Card', 'Line Pay', 'PromptPay'] 
            },
            'JP': { 
                symbol: 'Â¥', 
                rate: 0.22, 
                payments: ['ç¾é‡‘', 'åˆ·å¡', 'Suica/è¥¿ç“œå¡', 'PayPay', 'Apple Pay'] 
            }
        };

        const categories = {
            'shopping': ['é€£é–è—¥å¦ (Olive Young)', 'å¤§å‰µ (Daiso)', 'è¶…å¸‚/ä¾¿åˆ©åº—', 'æœé£¾/é‹åŒ…', 'å…ç¨…åº—', 'å…¶ä»–è³¼ç‰©'],
            'food': ['é¤å»³', 'è·¯é‚Šæ”¤', 'å’–å•¡å»³', 'é…’å§', 'ä¾¿åˆ©å•†åº—é£Ÿå“'],
            'transport': ['è¨ˆç¨‹è»Š', 'å…¬è»Š', 'æ·é‹/åœ°éµ', 'æ©Ÿå ´å·´å£«', 'åŒ…è»Š'],
            'stay': ['é£¯åº—', 'æ°‘å®¿', 'ç½®ç‰©æ«ƒ', 'å…¶ä»–']
        };

        // ç›®å‰ç‹€æ…‹
        let currentCountry = 'KR';
        let currentItems = []; // è³¼ç‰©ç±ƒ
        let ledger = []; // æ¨¡æ“¬è³‡æ–™åº«ï¼Œå­˜æ‰€æœ‰è¨˜å¸³ç´€éŒ„

        // --- åˆå§‹åŒ– ---
        window.onload = function() {
            document.getElementById('dateInput').valueAsDate = new Date();
            changeCountry(); // åˆå§‹åŒ–åœ‹å®¶è¨­å®š
            updateSubCats(); // åˆå§‹åŒ–åˆ†é¡
        };

        // --- 2. åŠŸèƒ½é‚è¼¯ ---

        // åˆ‡æ›åœ‹å®¶
        function changeCountry() {
            const val = document.getElementById('countrySelect').value;
            currentCountry = val;
            const config = countryConfig[val];

            // æ›´æ–°ç¬¦è™Ÿ
            document.getElementById('curSymbol').innerText = config.symbol;
            
            // æ›´æ–°åŒ¯ç‡é¡¯ç¤º (é‡æ–°è¨ˆç®—)
            manualAmountChange();

            // æ›´æ–°ä»˜æ¬¾æ–¹å¼é¸å–®
            const paySelect = document.getElementById('paymentMethod');
            paySelect.innerHTML = '';
            config.payments.forEach(pay => {
                const opt = document.createElement('option');
                opt.value = pay;
                opt.innerText = pay;
                paySelect.appendChild(opt);
            });
            // åŠ ä¸€å€‹é€šç”¨çš„
            const other = document.createElement('option');
            other.innerText = "â• è‡ªè¨‚/å…¶ä»–...";
            paySelect.appendChild(other);
        }

        // é€£å‹•å­åˆ†é¡
        function updateSubCats() {
            const main = document.getElementById('mainCat').value;
            const sub = document.getElementById('subCat');
            const list = categories[main];
            
            sub.innerHTML = ''; // æ¸…ç©º
            list.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item;
                opt.innerText = item;
                sub.appendChild(opt);
            });
        }

        // åŠ å…¥è³¼ç‰©ç±ƒé …ç›®
        function addItem() {
            const name = document.getElementById('itemName').value;
            const price = parseFloat(document.getElementById('itemPrice').value);
            if(!name || !price) return alert("è«‹è¼¸å…¥åç¨±èˆ‡é‡‘é¡");

            currentItems.push({name, price});

            // æ›´æ–°ä»‹é¢
            const li = document.createElement('li');
            li.innerText = `${name} - ${countryConfig[currentCountry].symbol}${price}`;
            document.getElementById('itemList').appendChild(li);

            // æ¸…ç©ºè¼¸å…¥
            document.getElementById('itemName').value = '';
            document.getElementById('itemPrice').value = '';

            // è‡ªå‹•æ›´æ–°ç¸½é‡‘é¡
            const total = currentItems.reduce((acc, item) => acc + item.price, 0);
            document.getElementById('amountInput').value = total;
            manualAmountChange(); // è§¸ç™¼æ›ç®—
        }

        // è¨ˆç®—å°å¹£
        function manualAmountChange() {
            const amount = parseFloat(document.getElementById('amountInput').value) || 0;
            const rate = countryConfig[currentCountry].rate;
            document.getElementById('twdDisplay').innerText = Math.round(amount * rate).toLocaleString();
        }

        // --- 3. å„²å­˜èˆ‡çµ±è¨ˆ ---

        function saveRecord() {
            const amount = parseFloat(document.getElementById('amountInput').value) || 0;
            if(amount === 0) return alert("é‡‘é¡æ˜¯ 0 è€¶ï¼Ÿç¢ºå®šå—ï¼Ÿ");

            const rate = countryConfig[currentCountry].rate;
            const twd = Math.round(amount * rate);
            const mainCat = document.getElementById('mainCat').value;
            const mainCatText = document.getElementById('mainCat').options[document.getElementById('mainCat').selectedIndex].text;

            // å­˜å…¥æ¨¡æ“¬è³‡æ–™åº«
            ledger.push({
                type: mainCat, // shopping, food...
                amountTWD: twd
            });

            // é‡ç½®ç•«é¢ (æ¨¡æ“¬)
            currentItems = [];
            document.getElementById('itemList').innerHTML = '';
            document.getElementById('amountInput').value = '';
            document.getElementById('twdDisplay').innerText = '0';
            alert("âœ… è¨˜å¸³æˆåŠŸï¼æ•¸æ“šå·²æ›´æ–°è‡³ä¸‹æ–¹çµ±è¨ˆæ¿");
            
            updateStats();
        }

        // æ›´æ–°çµ±è¨ˆçœ‹æ¿ (Dashboard)
        function updateStats() {
            // æ­¸é›¶
            let totals = { shopping: 0, food: 0, transport: 0, stay: 0, total: 0 };

            // é‡æ–°è¨ˆç®—
            ledger.forEach(record => {
                if(totals[record.type] !== undefined) {
                    totals[record.type] += record.amountTWD;
                }
                totals.total += record.amountTWD;
            });

            // æ›´æ–° HTML
            const html = `
                <div class="stats-row"><span>ğŸ›ï¸ è³¼ç‰©ç¸½è¨ˆ</span><span>NT$ ${totals.shopping.toLocaleString()}</span></div>
                <div class="stats-row"><span>ğŸœ ç¾é£Ÿç¸½è¨ˆ</span><span>NT$ ${totals.food.toLocaleString()}</span></div>
                <div class="stats-row"><span>ğŸšŒ äº¤é€šç¸½è¨ˆ</span><span>NT$ ${totals.transport.toLocaleString()}</span></div>
                <div class="stats-total stats-row"><span>ğŸ”¥ ä»Šæ—¥ç¸½èŠ±è²»</span><span>NT$ ${totals.total.toLocaleString()}</span></div>
            `;
            document.getElementById('statsContent').innerHTML = html;
        }

    </script>
</body>
</html>
